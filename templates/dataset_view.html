{% extends "base_vue.html" %}
{% from "_macros.html" import render_resource_link, render_rdfa_resource_link, get_label, facts_panel, summary_panel, content %}
{% block title %}{{get_label(this.description())}}{% endblock %}
{% block content %}
{% set attributes = this | include("attributes") | fromjson %}
{% set incoming = this | include("incoming") | fromjson | groupby("link_types.label") %}
{% set outgoing = this | include("outgoing") | fromjson  %}
    <md-card-header>
        <md-card-header-text>
            <div class="md-title">{{attributes.label}}</div>
            {% if attributes.type | length > 0 %}<div class="md-subhead">{{attributes['type'][0].label}}</div>{% endif %}
        </md-card-header-text>
        {% if attributes.thumbnail %}<md-card-media md-big >
            <img src="{{url_for("entity.view", uri=attributes.thumbnail)}}" alt="{{attributes.label}}"/>
        </md-card-media>{% endif %}
    </md-card-header>
    <md-card-content>
        <div class="md-layout md-gutter">
            <div class="md-layout-item">
                {% if attributes.type | length > 1 %}<div layout="row" class="md-subhead">
                    {% for type in attributes.type %}{{type.label}}{% if not loop.last %}, {% endif %} {% endfor %}
                </div>{% endif %}
                {% for desc in attributes.description %}<p><strong>{{desc.label}}:</strong> {{desc.value}}</p>
                <p>
                    <strong>Identifier: </strong> {{ attributes['@id']}}
                </p>
                {% endfor %}
                {% for attribute in attributes.attributes %}
                <p>
                    <strong>{{attribute.label}}: </strong>
                    {% for value in attribute['values'] %}
                        {{ value.value}} {% if value.unit_label %}<em>{{value.unit_label}}</em>{% endif %}
                        {% if not loop.last %}, {% endif %}
                    {% endfor %}
                </p>
                {% endfor %}
            </div>
            <div class="md-layout-item">
                {% for link_name, items in outgoing | groupby("link_label") %}
                <h2>{{link_name.title() }}</h2>
                <div class="md-layout md-gutter md-alignment-top-left">
                {% for item in items %}
                <md-card style="margin-bottom: 1em" class="md-layout-item">
                {% if this.graph.value(rdflib.URIRef(item.target), ns.foaf.depiction) %}
                  <md-card-media-cover md-solid>
                    <md-card-media md-ratio="1:1">
                        {% set depiction = this.graph.value(rdflib.URIRef(item.target), ns.foaf.depiction) %}
                        {% if depiction.startswith(config['lod_prefix']) %}
                        <img src="{{url_for('entity.view', uri=rfdlib.URIRef(depiction))}}" alt="{{item.target_label}}">
                        {% else %}
                        <img src="{{depiction}}" alt="{{item.target_label}}">
                        {% endif %}
                    </md-card-media>

                    <md-card-area>
                      <md-card-header>
                        <span class="md-title">{{item.target_label}}</span>
                      </md-card-header>

                      <md-card-actions>
                          <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target), view='view')}}" class="md-button-icon">View</md-button>
                          {% if this.graph.value(rdflib.URIRef(item.target), ns.whyis.hasFileID) %}
                          <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target))}}" class="md-button-icon">Download</md-button>
                          {% endif %}
                      </md-card-actions>
                    </md-card-area>
                  </md-card-media-cover>
                {% else %}
                    <md-card-header>
                        <div class="md-title">{{item.target_label}}</div>
                    </md-card-header>

                    <md-card-actions>
                        <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target), view='view')}}" class="md-button-icon">View</md-button>
                        {% if this.graph.value(rdflib.URIRef(item.target), ns.whyis.hasFileID) %}
                        <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target))}}" class="md-button-icon">Download</md-button>
                        {% endif %}
                    </md-card-actions>
                {% endif %}
                </md-card>
                {% endfor %}
            </div>
                {% endfor %}
                {% for link_name, items in incoming | groupby("link_label") %}
                <h2>{{link_name.title()}} Of</h2>
                <div class="md-layout md-gutter md-alignment-top-left">
                {% for item in items %}
                <md-card style="margin-bottom: 1em" class="md-layout-item">
                {% if this.graph.value(rdflib.URIRef(item.target), ns.foaf.depiction) %}
                  <md-card-media-cover md-solid>
                    <md-card-media md-ratio="1:1">
                        {% set depiction = this.graph.value(rdflib.URIRef(item.target), ns.foaf.depiction) %}
                        {% if depiction.startswith(config['lod_prefix']) %}
                        <img src="{{url_for('entity.view', uri=rfdlib.URIRef(depiction))}}" alt="{{item.target_label}}">
                        {% else %}
                        <img src="{{depiction}}" alt="{{item.target_label}}">
                        {% endif %}
                    </md-card-media>

                    <md-card-area>
                      <md-card-header>
                        <span class="md-title">{{item.target_label}}</span>
                      </md-card-header>

                      <md-card-actions>
                          <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target), view='view')}}" class="md-button-icon">View</md-button>
                          {% if this.graph.value(rdflib.URIRef(item.target), ns.whyis.hasFileID) %}
                          <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target))}}" class="md-button-icon">Download</md-button>
                          {% endif %}
                      </md-card-actions>
                    </md-card-area>
                  </md-card-media-cover>
                {% else %}
                    <md-card-header>
                        <div class="md-title">{{item.target_label}}</div>
                    </md-card-header>

                    <md-card-actions>
                        <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target), view='view')}}" class="md-button-icon">View</md-button>
                        {% if this.graph.value(rdflib.URIRef(item.target), ns.whyis.hasFileID) %}
                        <md-button href="{{url_for('entity.view', uri=rdflib.URIRef(item.target))}}" class="md-button-icon">Download</md-button>
                        {% endif %}
                    </md-card-actions>
                {% endif %}
                </md-card>
                {% endfor %}
            </div>
                {% endfor %}
            </div>
        </div>
    </md-card-content>
{% endblock %}
